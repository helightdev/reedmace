# Architecture

## Overview
The architecture of the system is based on the following components:

- **Shared Library**: contains the shared code between the server and the client. Alll models and
  serialization logic is defined here. Everything that is shared between the server and the client 
  must be defined or imported in this library or be available via dart:core.
- **Server**: the server application that defines the api routes and depends on the shared library.
- **Autogenerated Client**: automatically generated client code that depends on the shared library
  and provides bindings to the server api.
- **App**: the client application that depends on the shard library and the autogenerated client.

##  Flexibility
Though all of those services have a strong unidirectional dependency, Reedemace is designed to be
highly flexible and allows for a lot of customization. 

### Serialization
The serialization logic is designed to work
with [dogs](https://dogs.helight.dev/), but can be easily replaced with any other serialization
library if needed, since the full type information is available at runtime using type trees.

### Interceptors
The server and client both support interceptors both before, after and around the request. You can
also define global shelf middlewares for the server to use already existing middleware libraries.

### Request Context
The request context is available in the server and can be used to store and retrieve data that is
available throughout the request lifecycle. Interceptors and argument suppliers can access a
request-scoped metadata map to store and retrieve data.

### Shelf Handlers
You can create custom route registrations from shelf handlers using handy factory methods that
automatically handle most of the boilerplate for you.


## CLI Tool
To efficiently manage the server and client code, Reedmace provides a cli tool that works similar to
dart_frog and the build_runner tool. You can run the server and client directly from the command line
using `reedmace dev`. If any of the code changes, the build_runner will be automatically invoked to
rebuild affected code and restart the server if necessary.

!!! warning "Slow Performance"
    Reedmace is designed to not require you to wait for the code generator for many tasks. Running
    a full architecture rebuild `shared -> server -> client` can take a while though (up to 2 minutes).
    We are actively working on improving the performance of the code generator and the watcher to make the
    development experience even better.

## OpenAPI
Reedmace uses the openapi specification to define the api routes and automatically generates the
client bindings from the combination of the openapi specification and collected type information from
the server and shared library. If you do not want to use the autogenerated client or want to use
another language, you can use the openapi specification to generate client bindings for any language.